<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stickman Adventure</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
        }

        #gameContainer {
            border: 2px solid black;
            background: white;
            position: relative;
            overflow: hidden;
        }

        canvas {
            display: block;
            background: white;
        }

        #instructions {
            position: absolute;
            top: 10px;
            left: 10px;
            color: black;
            font-size: 14px;
            z-index: 10;
        }

        #score {
            position: absolute;
            top: 10px;
            right: 10px;
            color: black;
            font-size: 16px;
            font-weight: bold;
            z-index: 10;
        }
    </style>
</head>

<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="400"></canvas>
        <div id="instructions">Use ARROW KEYS or WASD to move and jump</div>
        <div id="score">Items: 0/5</div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');

        // Game state
        let gameState = 'playing'; // 'playing', 'ending'
        let camera = { x: 0, y: 0 };
        let endingTimer = 0;

        // Player object
        const player = {
            x: 50,
            y: 300,
            width: 20,
            height: 40,
            velX: 0,
            velY: 0,
            grounded: false,
            speed: 3,
            jumpPower: 12
        };

        // Platforms
        const platforms = [
            { x: 0, y: 350, width: 200, height: 50 },
            { x: 250, y: 300, width: 150, height: 20 },
            { x: 450, y: 250, width: 100, height: 20 },
            { x: 600, y: 200, width: 120, height: 20 },
            { x: 800, y: 180, width: 200, height: 20 },
            { x: 1050, y: 220, width: 150, height: 20 },
            { x: 1250, y: 300, width: 300, height: 100 }
        ];

        // Collectible items (green squares representing plants)
        const items = [
            { x: 280, y: 270, collected: false },
            { x: 480, y: 220, collected: false },
            { x: 650, y: 170, collected: false },
            { x: 850, y: 150, collected: false },
            { x: 1300, y: 270, collected: false }
        ];

        // Input handling
        const keys = {};

        document.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });

        // Draw stick figure
        function drawPlayer() {
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';

            const centerX = player.x + player.width / 2;
            const centerY = player.y + player.height / 2;

            // Head
            ctx.beginPath();
            ctx.arc(centerX, player.y + 8, 6, 0, Math.PI * 2);
            ctx.stroke();

            // Body
            ctx.beginPath();
            ctx.moveTo(centerX, player.y + 14);
            ctx.lineTo(centerX, player.y + 28);
            ctx.stroke();

            // Arms
            ctx.beginPath();
            ctx.moveTo(centerX - 8, player.y + 20);
            ctx.lineTo(centerX + 8, player.y + 20);
            ctx.stroke();

            // Legs
            ctx.beginPath();
            ctx.moveTo(centerX, player.y + 28);
            ctx.lineTo(centerX - 6, player.y + 38);
            ctx.moveTo(centerX, player.y + 28);
            ctx.lineTo(centerX + 6, player.y + 38);
            ctx.stroke();
        }

        // Draw platforms
        function drawPlatforms() {
            ctx.fillStyle = 'black';
            platforms.forEach(platform => {
                ctx.fillRect(platform.x - camera.x, platform.y, platform.width, platform.height);
            });
        }

        // Draw collectible items
        function drawItems() {
            ctx.fillStyle = 'green';
            items.forEach(item => {
                if (!item.collected) {
                    // Draw a simple plant-like shape
                    ctx.fillRect(item.x - camera.x, item.y, 10, 10);
                    // Add some "leaves"
                    ctx.fillRect(item.x - camera.x - 2, item.y + 3, 6, 4);
                    ctx.fillRect(item.x - camera.x + 6, item.y + 3, 6, 4);
                }
            });
        }

        // Update player physics
        function updatePlayer() {
            if (gameState !== 'playing') return;

            // Horizontal movement
            if (keys['arrowleft'] || keys['a']) {
                player.velX = -player.speed;
            } else if (keys['arrowright'] || keys['d']) {
                player.velX = player.speed;
            } else {
                player.velX *= 0.8; // Friction
            }

            // Jumping
            if ((keys['arrowup'] || keys['w'] || keys[' ']) && player.grounded) {
                player.velY = -player.jumpPower;
                player.grounded = false;
            }

            // Gravity
            player.velY += 0.5;

            // Update position
            player.x += player.velX;
            player.y += player.velY;

            // Platform collision
            player.grounded = false;
            platforms.forEach(platform => {
                if (player.x < platform.x + platform.width &&
                    player.x + player.width > platform.x &&
                    player.y < platform.y + platform.height &&
                    player.y + player.height > platform.y) {

                    // Landing on top
                    if (player.velY > 0 && player.y < platform.y) {
                        player.y = platform.y - player.height;
                        player.velY = 0;
                        player.grounded = true;
                    }
                }
            });

            // Collect items
            items.forEach(item => {
                if (!item.collected &&
                    player.x < item.x + 10 &&
                    player.x + player.width > item.x &&
                    player.y < item.y + 10 &&
                    player.y + player.height > item.y) {
                    item.collected = true;
                }
            });

            // Check if all items collected and near end
            const collectedCount = items.filter(item => item.collected).length;
            if (collectedCount === items.length && player.x > 1200) {
                gameState = 'ending';
                endingTimer = 0;
            }

            // Update camera to follow player
            camera.x = player.x - canvas.width / 3;
            if (camera.x < 0) camera.x = 0;
        }

        // Draw ending sequence
        function drawEnding() {
            endingTimer++;

            // Draw player facing camera (front view)
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            // Head
            ctx.beginPath();
            ctx.arc(centerX, centerY - 20, 15, 0, Math.PI * 2);
            ctx.stroke();

            // Body
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 5);
            ctx.lineTo(centerX, centerY + 25);
            ctx.stroke();

            // Arms
            ctx.beginPath();
            ctx.moveTo(centerX - 15, centerY + 5);
            ctx.lineTo(centerX + 15, centerY + 5);
            ctx.stroke();

            // Legs
            ctx.beginPath();
            ctx.moveTo(centerX, centerY + 25);
            ctx.lineTo(centerX - 10, centerY + 45);
            ctx.moveTo(centerX, centerY + 25);
            ctx.lineTo(centerX + 10, centerY + 45);
            ctx.stroke();

            // Draw green item in hand
            if (endingTimer > 60) {
                ctx.fillStyle = 'green';
                ctx.fillRect(centerX + 10, centerY, 8, 8);
                ctx.fillRect(centerX + 8, centerY + 2, 4, 4);
                ctx.fillRect(centerX + 16, centerY + 2, 4, 4);
            }

            // Draw smoke effect
            if (endingTimer > 120) {
                ctx.strokeStyle = 'gray';
                ctx.lineWidth = 2;
                for (let i = 0; i < 5; i++) {
                    const waveY = centerY - 10 + Math.sin((endingTimer + i * 20) * 0.1) * 3;
                    ctx.beginPath();
                    ctx.arc(centerX + Math.random() * 20 - 10, waveY - i * 8, 3 + Math.random() * 2, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }

            // Victory text
            ctx.fillStyle = 'black';
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Level Complete!', centerX, 50);

            if (endingTimer > 180) {
                ctx.font = '16px Arial';
                ctx.fillText('Press R to restart', centerX, 80);

                if (keys['r']) {
                    // Reset game
                    player.x = 50;
                    player.y = 300;
                    player.velX = 0;
                    player.velY = 0;
                    camera.x = 0;
                    gameState = 'playing';
                    items.forEach(item => item.collected = false);
                }
            }
        }

        // Update score display
        function updateScore() {
            const collected = items.filter(item => item.collected).length;
            scoreEl.textContent = `Items: ${collected}/${items.length}`;
        }

        // Main game loop
        function gameLoop() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (gameState === 'playing') {
                updatePlayer();
                drawPlatforms();
                drawItems();
                drawPlayer();
            } else if (gameState === 'ending') {
                drawEnding();
            }

            updateScore();
            requestAnimationFrame(gameLoop);
        }

        // Start the game
        gameLoop();
    </script>
</body>

</html>